<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Avista ‚Äî Destiny V2</title>
<style>
body{
  margin:0; font-family:"Segoe UI",Arial,sans-serif; color:#f5f5f5;
  min-height:100vh;
  background:
    linear-gradient(rgba(15,7,35,0.88), rgba(15,7,35,0.88)),
    url("banniere.jpg") center / cover no-repeat fixed;
}
.header{
  text-align:center; padding:80px 20px 40px;
}
.header h1{
  margin:0; font-size:36px; background: rgba(76,29,149,0.75);
  display:inline-block; padding:18px 36px; border-radius:18px; box-shadow:0 20px 50px rgba(0,0,0,0.6);
}
.header p{ margin-top:15px; opacity:0.85; }

#backBtn{
  margin-top:10px; padding:8px 16px; border:none; border-radius:12px;
  background:#9333ea; color:white; cursor:pointer;
}

.container{ max-width:950px; margin:auto; padding:20px 25px 80px; display:grid; grid-gap:25px; }

.card{
  background: rgba(76,29,149,0.82); backdrop-filter:blur(8px);
  border-radius:20px; padding:25px; cursor:pointer; transition:0.3s;
  box-shadow:0 15px 50px rgba(0,0,0,0.5);
}
.card:hover{ transform:scale(1.02); }

.card h3{ margin:0 0 10px 0; }

.badge{ display:inline-block; padding:6px 14px; border-radius:20px; font-weight:700; color:white; }
.up{ background: linear-gradient(135deg,#16a34a,#22c55e); }
.demote{ background: linear-gradient(135deg,#dc2626,#ef4444); }

.date{ margin-top:10px; font-size:13px; opacity:0.7; }

.empty{ text-align:center; margin-top:60px; opacity:0.7; font-size:18px; }

/* MODAL */
.modal-bg{ display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background: rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999; animation:fadein 0.3s;}
@keyframes fadein{ from{opacity:0} to{opacity:1} }
.modal{ background:rgba(76,29,149,0.95); padding:25px; border-radius:18px;
max-width:600px; width:90%; position:relative; color:#fff; max-height:80vh; overflow-y:auto;
transform: scale(0.9); transition: transform 0.2s ease-in-out; }
.modal.show{ transform: scale(1); }

.modal h2{ margin-top:0; }
.modal ul{ padding-left:20px; }
.modal textarea{ width:100%; min-height:60px; margin-top:10px; border-radius:10px; padding:10px; border:none; resize:vertical; }
.modal button{ margin-top:10px; padding:10px 20px; border:none; border-radius:12px; cursor:pointer; background:#9333ea; color:white; }
.close-btn{ position:absolute; top:10px; right:15px; cursor:pointer; font-size:20px; font-weight:bold; }

.signature{ position:fixed; bottom:10px; right:15px; opacity:0.7; font-size:13px; }
.deleteBtn{ background:#dc2626; margin-left:10px; }
</style>
</head>
<body>

<div class="header">
  <h1> Avis Staff ‚Äî Destiny V2</h1>
  <p>Consultation interne des √©valuations staff</p>
  <button id="backBtn" onclick="window.location.href='index.html'">‚Üê Retour</button>
</div>

<div class="container" id="avisContainer"></div>

<!-- MODAL -->
<div class="modal-bg" id="modalBg">
  <div class="modal" id="modal">
    <span class="close-btn" id="closeModal">&times;</span>
    <h2 id="modalTitle"></h2>
    <p id="modalAvis"></p>
    <p><strong>üü¢ Points positifs:</strong></p>
    <ul id="modalPositif"></ul>
    <p><strong>üü† √Ä am√©liorer:</strong></p>
    <ul id="modalAmeliorer"></ul>
    <p><strong>üìä D√©cision:</strong> <span id="modalDecision"></span></p>
    <p><strong>üïí Date:</strong> <span id="modalDate"></span></p>

    <p><strong>üí¨ Commentaires :</strong></p>
    <div id="modalCommentaires"></div>
    <textarea id="newComment" placeholder="Ajouter un commentaire..."></textarea>
    <button onclick="ajouterCommentaire()">Ajouter</button>
    <button class="deleteBtn" onclick="supprimerAvis()">Supprimer mon avis</button>
  </div>
</div>

<div class="signature">site cr√©√© par Welonyx le GOAT</div>

<script>
let avisList = JSON.parse(localStorage.getItem("avis_staff")||"[]");
const container = document.getElementById("avisContainer");

function afficherAvis(){
  container.innerHTML="";
  if(avisList.length===0){
    container.innerHTML='<div class="empty">Aucun avis staff n‚Äôa encore √©t√© r√©dig√©.</div>';
    return;
  }
  avisList.reverse().forEach((a,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<h3>${a.staff} ‚Äî ${a.role}</h3>
    <span class="badge ${a.decision==="UP"?"up":"demote"}">${a.decision}</span>
    <div class="date">${a.date}</div>`;
    card.onclick=()=>ouvrirModal(i);
    container.appendChild(card);
  });
}

let currentIndex=null;
const modalBg=document.getElementById("modalBg");
const modalTitle=document.getElementById("modalTitle");
const modalAvis=document.getElementById("modalAvis");
const modalPositif=document.getElementById("modalPositif");
const modalAmeliorer=document.getElementById("modalAmeliorer");
const modalDecision=document.getElementById("modalDecision");
const modalDate=document.getElementById("modalDate");
const modalCommentaires=document.getElementById("modalCommentaires");
const newComment=document.getElementById("newComment");

function ouvrirModal(i){
  currentIndex=i;
  const a=avisList[i];
  modalTitle.textContent=`${a.staff} ‚Äî ${a.role}`;
  modalAvis.textContent=a.avis;

  modalPositif.innerHTML=a.positif.split("\n").map(l=>`<li>${l}</li>`).join("");
  modalAmeliorer.innerHTML=a.ameliorer.split("\n").map(l=>`<li>${l}</li>`).join("");

  modalDecision.textContent=a.decision;
  modalDate.textContent=a.date;
  afficherCommentaires();
  modalBg.style.display="flex";
  setTimeout(()=>document.getElementById("modal").classList.add("show"),10);
}

document.getElementById("closeModal").onclick=()=>{
  modalBg.style.display="none"; document.getElementById("modal").classList.remove("show"); newComment.value="";
}

function afficherCommentaires(){
  modalCommentaires.innerHTML="";
  const coms=avisList[currentIndex].commentaires||[];
  if(coms.length===0) modalCommentaires.innerHTML="<p style='opacity:0.7'>Pas encore de commentaires.</p>";
  else coms.forEach(c=>{const p=document.createElement("p"); p.textContent="üí¨ "+c; modalCommentaires.appendChild(p);});
}

function ajouterCommentaire(){
  const texte=newComment.value.trim();
  if(!texte) return;
  avisList[currentIndex].commentaires.push(texte);
  localStorage.setItem("avis_staff", JSON.stringify(avisList));
  newComment.value="";
  afficherCommentaires();
}

function supprimerAvis(){
  if(confirm("Voulez-vous vraiment supprimer cet avis ?")){
    avisList.splice(currentIndex,1); 
    localStorage.setItem("avis_staff",JSON.stringify(avisList));
    modalBg.style.display="none";
    afficherAvis(); 
  }
}

afficherAvis();
</script>

</body>
</html>
